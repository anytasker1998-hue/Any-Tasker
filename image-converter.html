<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Image Converter (Working Version)</title>
  <style>
    body{font-family:Arial;background:#e9f5ff;padding:20px;margin:0}
    .box{max-width:600px;margin:auto;background:#fff;padding:20px;border-radius:12px;box-shadow:0 4px 18px rgba(0,0,0,0.1)}
    h2{text-align:center;color:#0ea5ff;margin-top:0}
    input,select,button{width:100%;padding:10px;margin-top:10px;border-radius:8px;border:1px solid #cbd5e1}
    button{background:#0ea5ff;color:#fff;font-weight:bold;border:none;cursor:pointer}
    button:disabled{background:#9ccff5}
    #preview{margin-top:15px;max-width:100%;border:1px solid #e2e8f0;border-radius:8px}
    #downloadBtn{margin-top:15px;display:none}
  </style>
</head>
<body>
  <div class="box">
    <h2>Image Converter (Fully Working)</h2>

    <input type="file" id="fileInput" accept="image/*">

    <select id="format">
      <option value="image/png">PNG</option>
      <option value="image/jpeg">JPEG</option>
      <option value="image/webp">WEBP</option>
    </select>

    <label>Quality (JPEG/WEBP)</label>
    <input type="range" id="quality" min="10" max="100" value="90">

    <button id="convertBtn" disabled>Convert Image</button>

    <img id="preview" />

    <a id="downloadBtn" class="btn" download>Download Converted Image</a>
  </div>

<script>
let originalFile;
let convertedBlob;

const fileInput = document.getElementById("fileInput");
const convertBtn = document.getElementById("convertBtn");
const preview = document.getElementById("preview");
const downloadBtn = document.getElementById("downloadBtn");

fileInput.addEventListener("change", function(){
  originalFile = this.files[0];
  if(!originalFile) return;

  convertBtn.disabled = false;

  const reader = new FileReader();
  reader.onload = e => {
    preview.src = e.target.result;
  };
  reader.readAsDataURL(originalFile);
});

convertBtn.addEventListener("click", async function(){
  const format = document.getElementById("format").value;
  const quality = document.getElementById("quality").value / 100;

  const img = new Image();

  img.onload = () => {
    const canvas = document.createElement("canvas");
    const ctx = canvas.getContext("2d");

    canvas.width = img.width;
    canvas.height = img.height;
    ctx.drawImage(img, 0, 0);

    canvas.toBlob(blob => {
      convertedBlob = blob;
      const url = URL.createObjectURL(blob);
      preview.src = url;

      downloadBtn.href = url;
      downloadBtn.download = "converted." + format.split("/")[1];
      downloadBtn.style.display = "block";
    }, format, quality);
  };

  img.src = URL.createObjectURL(originalFile);
});
</script>
</body>
</html>
